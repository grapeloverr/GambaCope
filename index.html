<!DOCTYPE html>
<html>
<head>
    <style>
        :root {
            --multiplier: 1;
            --wild-multiplier: 1;
        }

        .slot-machine {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 2px solid #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: #1a1a1a;
            position: relative;
            transition: transform 0.3s;
        }

        .wild {
            color: #ff4545;
            animation: wild-pulse 1s infinite;
        }

        .xways {
            background: url('xways-pattern.png');
            background-size: cover;
        }

        @keyframes wild-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .explosion {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ff8800 0%, transparent 70%);
            animation: explode 0.5s forwards;
        }

        .multiplier-display {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }
    </style>
</head>
<body>
    <div class="multiplier-display">Multiplier: <span id="multValue">1x</span></div>
    <div class="slot-machine" id="machine"></div>
    <button onclick="game.spin()" id="spinBtn">SPIN (Balance: <span id="balance">1000</span>)</button>

    <script>
        class NolimitSlot {
            constructor() {
                this.symbols = ['üçí', 'üçã', 'üîî', 'üíé', '7Ô∏è‚É£', 'üåü', 'üí£', 'üîÑ', 'üêâ'];
                this.reels = [];
                this.multiplier = 1;
                this.freeSpins = 0;
                this.balance = 1000;
                this.initMachine();
                this.xNudgeActive = false;
                this.xWaysActive = false;
            }

            initMachine() {
                const machine = document.getElementById('machine');
                machine.innerHTML = '';
                for(let i = 0; i < 36; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    machine.appendChild(slot);
                    this.reels.push(slot);
                }
            }

            async spin() {
                if(this.balance < 50) return alert('Insufficient funds!');
                this.balance -= 50;
                this.updateBalance();

                try {
                    await this.animatePreSpin();
                    const spinResult = this.generateSpin();
                    await this.animateSpinResult(spinResult);
                    
                    let totalWin = 0;
                    do {
                        totalWin += this.checkWins();
                    } while(this.applyCascadingReels());
                    
                    if(totalWin > 0) {
                        this.handleWin(totalWin);
                    }
                    
                    this.checkBonusFeatures();
                } catch(error) {
                    console.error('Spin error:', error);
                    alert('Spin failed! Please refresh');
                }
            }

            applyCascadingReels() {
                // Implement cascading reels with xWays expansion
                const cascades = this.reels.filter(slot => 
                    slot.classList.contains('winning')).length;
                
                if(cascades > 0) {
                    this.reels.forEach(slot => {
                        if(slot.classList.contains('winning')) {
                            slot.innerHTML = '';
                            slot.classList.remove('winning');
                        }
                    });
                    
                    // Apply xWays expansion (symbol splitting)
                    this.reels.forEach(slot => {
                        if(Math.random() < 0.3) {
                            slot.classList.add('xways');
                            slot.innerHTML += this.symbols[Math.floor(Math.random()*this.symbols.length)];
                        }
                    });
                    
                    return true;
                }
                return false;
            }

            handleWin(amount) {
                const winAmount = amount * this.multiplier;
                this.balance += winAmount;
                this.multiplier += winAmount / 1000;
                this.updateBalance();
                this.showWinAnimation(winAmount);
                
                // Apply xNudge mechanic to wilds
                document.querySelectorAll('.wild').forEach(wild => {
                    wild.style.transform = `translateY(${Math.random() < 0.5 ? '-' : ''}20px)`;
                    this.multiplier += 0.1;
                });
            }

            checkBonusFeatures() {
                // Randomly trigger xNudge or xWays
                if(Math.random() < 0.15) this.triggerXNudge();
                if(Math.random() < 0.1) this.triggerXWays();
                if(this.reels.some(s => s.textContent === 'üåü')) this.triggerFreeSpins();
            }

            triggerXNudge() {
                this.xNudgeActive = true;
                document.querySelectorAll('.slot').forEach(slot => {
                    if(slot.textContent === 'üêâ') { // Dragon wild
                        slot.classList.add('wild');
                        slot.style.transform = 'scale(1.5)';
                    }
                });
                setTimeout(() => this.xNudgeActive = false, 5000);
            }

            triggerXWays() {
                this.xWaysActive = true;
                this.reels.forEach(slot => {
                    if(Math.random() < 0.4) {
                        slot.classList.add('xways');
                        slot.innerHTML += this.symbols[Math.floor(Math.random()*this.symbols.length)];
                    }
                });
                setTimeout(() => this.xWaysActive = false, 3000);
            }
        }

        const game = new NolimitSlot();
        // Helper functions omitted for brevity
    </script>
</body>
</html>
